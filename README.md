# Catapult

Catapult is an automated tool for running Mass Spectrometry Search on files generated by the instrument. It is used to watch for new files and process them as they are created according to specified experimental parameters.

## Installation

### Windows

Docker and Python 3.10 is required for simple deployment on windows.

1. Install Docker Desktop from [Docker Hub](https://hub.docker.com/editions/community/docker-ce-desktop-windows)
2. Install Python 3.10 from [Python.org](https://www.python.org/downloads/release/python-3100/)
3. Download the repository to your local machine
4. Open a terminal and navigate to the repository
5. Run `pip install -r requirements.txt` to install the required python packages
6. Run `docker-compose up -d` to start the application
7. Open a web browser and navigate to `http://localhost/admin` to access the application
8. Create a superuser account by running `docker-compose exec -it catapult python manage.py createsuperuser` and following the prompts
9. Log in to the application using the superuser account

### Linux

To be added

## Operation

Modify the `settings.py` file in the `catapult_backend` directory at the DIANN_PATH and replace `r"C:\DIA-NN\1.8.1\DiaNN.exe"` with your `DiaNN.exe` executable path

or in your terminal or environment variable editor, set the following environment variables:
- DIANN_PATH: The path to the `DiaNN.exe` executable

### To setup a process to watch for new files and dispatch the job for processing them

In the terminal, run `python manage.py start_sentinel`

### To setup a process to check for files that are ready to be processed and dispatch the job for processing them

In the terminal, run `python manage.py database_check --queue`

### To create a worker to process the dispatched jobs

In the terminal, run `python manage.py create_worker_template <worker_name> <hostname>`

The above would create a worker template json file (example below) in the base folder of the project. Modify the file to include the necessary parameters for the worker to process the job.

```json
{
    "name": "worker1",
    "type": "worker",
    "options": {
        "concurrency": 1,
        "loglevel": "INFO",
        "app": "catapult_backend",
        "hostname": "worker1@diann",
        "P": "solo",
        "Q": "default",
        "logfile": "worker1.log"
    },
    "folder_path_translations": {}
}
```
Not all parameters in worker template are currently being used.

Then to run the worker, `python manage.py worker_native --config=<worker_template_file> --verbosity=2`



